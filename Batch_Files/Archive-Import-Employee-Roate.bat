	@echo off
	cls
	setlocal ENABLEDELAYEDEXPANSION



::========================================================================================================================================
::
::-------[ TITLE 		]  :  BATCH SCRIPT : IMPORT, ARCHIVE & ROTATE : Employee Demographic File - Daily
::
::========================================================================================================================================


::----------------------------------------------------------------------------------------------------------------------------------------
::
::-------[ AUTHOR		] : Roger Corley
::-------[ CREATED		] : August 20, 2015 1:46:37 PM
::-------[ COPYRIGHT		] : Common CENTS Solutions - 2015
::
::----------------------------------------------------------------------------------------------------------------------------------------


::========================================================================================================================================
:: Description:
::========================================================================================================================================
::
::	A daily run batch file that tests if the demographic file exists and then starts the RUNSCRIPT import process.
::
::----------------------------------------------------------------------------------------------------------------------------------------
::
::	VARIABLES TO CONFIGURE
::----------------------------------------------------------------------------------------------------------------------------------------
::
::	SET "fileName="	Enter the filename with extension to be imported.
::
::	SET "archExt="		Enter the desired extension for the archived imported file.
::				**  If no specific extension is required, do not modify.
::
::	SET "gemDRIVE=C:\"	Enter the DRIVE LETTER when the GEM directory is located
::				**  ONLY CHANGE THE DRIVE LETTER! DO NOT MODIFY OR REMOVE THE ' :\ '
::
::	SET "rsSVR=(local)"	Enter the COMPUTERNAME\SQLNAME of the SQL Server hosting the GEMdb database.
::				**  If the GEMdb is on the local machine, enter (local) -- with parenthesis -- within double-quotes.
::
::	SET "rsMODULE=300"	Enter the sModule number that will be used for this import file.
::				**  You can locate this value in SQL Server\GEMdb --> cfgScriptParams --> KeyValue 'sModule'
::
::	This batch file will also rotate any existing archived demographic files. You can set the number
::	of archived files to keep by changing the 'skip' number in the FOR statement towards the end of this script.
::	Search this file for ( for /f "skip= ). Copy everything starting with for and ending with the equals sign.
::
::	Once you find the FOR statement, ONLY CHANGE THE NUMBER following the equals sign.
::	This wil be the number of days to keep archived files. DO NOT CHANGED ANYTHING ELSE IN THIS STATEMENT!
::
::	DO NOT MODIFY ANYTHING ELSE IN THIS SCRIPT OR IT WILL NOT WORK!
::
::	If you have any questions or problems with this script, contact Roger Corley at Common CENTS Solutions.
::
::
::========================================================================================================================================
::========================================================================================================================================




::========================================================================================================================================
::
::-------[ ENVIRONMENT VARIABLES ] : Directories & FileNames
::========================================================================================================================================

	SET "fileName=CCDEMO.25325"
	SET "archExt=.SAV"


::========================================================================================================================================
::
::-------[ SCRIPT VARIABLES ] : RunScript Variables
::========================================================================================================================================

	SET "rsSVR=SPOTWPAPPGEM02"
	SET "rsMODULE=300"






::========================================================================================================================================
::========================================================================================================================================
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::----------------------------------------------------------------------------------------------------------------------------------------
::
::	*****	DO NOT MODIFY ANYTHING PAST THIS POINT	*****
::
::----------------------------------------------------------------------------------------------------------------------------------------
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::========================================================================================================================================
::========================================================================================================================================






::========================================================================================================================================
::
::-------[ ****  DATE CONSTANTS : DO NOT MODIFY  ****  ]
::========================================================================================================================================

	for /f "delims=" %%a in ('wmic OS Get localdatetime  ^| find "."') do set "dt=%%a"

	set "YYYY=%dt:~0,4%"
	set "MM=%dt:~4,2%"
	set "DD=%dt:~6,2%"
	set "hh=%dt:~8,2%"
	set "min=%dt:~10,2%"
	set "ss=%dt:~12,2%"

	set "stamp=_%YYYY%-%MM%-%DD%"


::========================================================================================================================================
::
::-------[ ****  COUNT CONSTANT : DO NOT MODIFY  ****  ]
::========================================================================================================================================

	SET /a cnt=0


::========================================================================================================================================
::
::-------[ ****  ENVIRONMENT CONSTANTS : DO NOT MODIFY  ****  ]
::========================================================================================================================================

	SET "gemDIR=%GEM%"

	SET "ieDIR=%gemDIR%\ImportExport"
	SET "arcDIR=%ieDIR%\Archive\Import-Employees-Archives"



::========================================================================================================================================
::
::-------[ ****  SCRIPT START  ****  ]
::========================================================================================================================================


	echo Beginning Import Employee File and Archive Rotataton ...


::-------[  TEST-FILE-EXISTS ] : Import-Employee-File
::----------------------------------------------------------------------------------------------------------------------------------------

	if not exist %ieDIR%\%fileName% goto NOFILE



::-------[  IMPORT-FILE ] : RUNSCRIPT
::----------------------------------------------------------------------------------------------------------------------------------------

	%gemDIR%\runscript script=Import_v1_70.gsf,pw=gemie,svr=%rsSVR%,core=1,module=%rsMODULE%,include=gsf.txt




::-------[  DIRECTORY	] : Change to Target Directory
::----------------------------------------------------------------------------------------------------------------------------------------

	CD /d %arcDIR%




::-------[  COPY ORIGINAL ] : If Original File Exists, Copy to Archive Directory and Rename
::----------------------------------------------------------------------------------------------------------------------------------------

	if exist "%ieDIR%\%fileName%" (

		move "!ieDIR!\!fileName!" "!arcDIR!\!fileName!!stamp!!archExt!"

		goto Rotate

	) else (

		goto Done
	)



::========================================================================================================================================

:ROTATE
::========================================================================================================================================


::-------[  ROTATE SCRIPT ] : Rotate Archived Files
::----------------------------------------------------------------------------------------------------------------------------------------

	for /f "skip=14 eol=: delims=" %%F in ('dir /b /o-d %fileName%_*') do @del "%%F"




::========================================================================================================================================

:NOFILE
::========================================================================================================================================




::========================================================================================================================================

:DONE
::========================================================================================================================================
	echo Import Employee File and Archive Rotate Complete...


