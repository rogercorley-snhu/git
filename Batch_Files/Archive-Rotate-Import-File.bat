	@echo off
	cls
	setlocal ENABLEDELAYEDEXPANSION



::========================================================================================================================================
::
::-------[ TITLE 		]  :  BATCH SCRIPT : ARCHIVE & ROTATE : "<***** FILE-NAME *****>" Demographic File - Daily
::
::========================================================================================================================================


::----------------------------------------------------------------------------------------------------------------------------------------
::
::-------[ AUTHOR		] : Roger Corley
::-------[ CREATED		] : August 27, 2015 12:05:07 PM
::-------[ COPYRIGHT		] : Common CENTS Solutions - 2015
::
::----------------------------------------------------------------------------------------------------------------------------------------


::========================================================================================================================================
:: Description:
::========================================================================================================================================
::
::	A daily run batch file that tests if the demographic file exists and then starts the RUNSCRIPT import process.
::
::----------------------------------------------------------------------------------------------------------------------------------------
::
::	VARIABLES TO CONFIGURE
::----------------------------------------------------------------------------------------------------------------------------------------
::
::	SET "fileName="	Enter the filename with extension to be imported.
::
::	SET "archExt="		Enter the desired extension for the archived imported file.
::				**  If no specific extension is required, do not modify.
::
::	SET "gemDRIVE=C:\"	Enter the DRIVE LETTER when the GEM directory is located
::				**  ONLY CHANGE THE DRIVE LETTER! DO NOT MODIFY OR REMOVE THE ' :\ '
::
::	This batch file will also rotate any existing archived demographic files. You can set the number
::	of archived files to keep by changing the 'skip' number in the FOR statement towards the end of this script.
::	Search this file for ( for /f "skip= ). Copy everything starting with for and ending with the equals sign.
::
::	Once you find the FOR statement, ONLY CHANGE THE NUMBER following the equals sign.
::	This wil be the number of days to keep archived files. DO NOT CHANGED ANYTHING ELSE IN THIS STATEMENT!
::
::	DO NOT MODIFY ANYTHING ELSE IN THIS SCRIPT OR IT WILL NOT WORK!
::
::	If you have any questions or problems with this script, contact Roger Corley at Common CENTS Solutions.
::
::
::========================================================================================================================================
::========================================================================================================================================




::========================================================================================================================================
::
::-------[ ENVIRONMENT VARIABLES ] : Directories & FileNames
::========================================================================================================================================

	SET "fileName=<****** FILE-NAME ******>"
	SET "archExt=.SAV"





::========================================================================================================================================
::========================================================================================================================================
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::----------------------------------------------------------------------------------------------------------------------------------------
::
::	*****	DO NOT MODIFY ANYTHING PAST THIS POINT	*****
::
::----------------------------------------------------------------------------------------------------------------------------------------
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::========================================================================================================================================
::========================================================================================================================================






::========================================================================================================================================
::
::-------[ ****  DATE CONSTANTS : DO NOT MODIFY  ****  ]
::========================================================================================================================================

	for /f "delims=" %%a in ('wmic OS Get localdatetime  ^| find "."') do set "dt=%%a"

	set "YYYY=%dt:~0,4%"
	set "MM=%dt:~4,2%"
	set "DD=%dt:~6,2%"
	set "hh=%dt:~8,2%"
	set "min=%dt:~10,2%"
	set "ss=%dt:~12,2%"

	set "stamp=_%YYYY%-%MM%-%DD%"


::========================================================================================================================================
::
::-------[ ****  COUNT CONSTANT : DO NOT MODIFY  ****  ]
::========================================================================================================================================

	SET /a cnt=0


::========================================================================================================================================
::
::-------[ ****  ENVIRONMENT CONSTANTS : DO NOT MODIFY  ****  ]
::========================================================================================================================================

	SET "gemDIR=%GEM%"

	SET "ieDIR=%gemDIR%\ImportExport"
	SET "arcDIR=%ieDIR%\Archive\Import-Employees-Archives\<****** DIRECTORY-NAME ******>"



::========================================================================================================================================
::
::-------[ ****  SCRIPT START  ****  ]
::========================================================================================================================================


	echo Beginning Archive %fileName% Import File Rotatation ...


::-------[  TEST-FILE-EXISTS ] : Import-Employee-File
::----------------------------------------------------------------------------------------------------------------------------------------

	if not exist %ieDIR%\%fileName% goto NOFILE

	echo [MESSAGE] : %ieDIR%\%fileName% exists



::-------[  DIRECTORY	] : Change to Target Directory
::----------------------------------------------------------------------------------------------------------------------------------------

	CD /d %arcDIR%

	echo [MESSAGE] : Changing directory to %arcDIR%



::-------[  COPY ORIGINAL ] : If Original File Exists, Copy to Archive Directory and Rename
::----------------------------------------------------------------------------------------------------------------------------------------

	if exist %ieDIR%\%fileName% (

		echo [MESSAGE] : Start File Copy

		copy "!ieDIR!\!fileName!" "!arcDIR!\!fileName!!stamp!!archExt!"


		goto ROTATE

	) else (

		goto DONE
	)



::========================================================================================================================================

:ROTATE
::========================================================================================================================================


::-------[  ROTATE SCRIPT ] : Rotate Archived Files
::----------------------------------------------------------------------------------------------------------------------------------------

	echo [MESSAGE] : Beginning Archive Rotations.


	for /f "skip=7 eol=: delims=" %%F in ('dir /b /o-d %fileName%_*') do @del "%%F"


	goto DONE



::========================================================================================================================================

:NOFILE
::========================================================================================================================================

	echo [ERROR] :  %ieDIR%\%filename% Not Found : Exiting Script


::========================================================================================================================================

:DONE
::========================================================================================================================================
	echo Archive %fileName% Import File Rotatation Complete...


