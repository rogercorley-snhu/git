	@echo off
	cls
	setlocal ENABLEDELAYEDEXPANSION

::========================================================================================================================================
:: Title:    Rotate GEMonline & GEMdaily Logs -- Weekly
::========================================================================================================================================
::
::	Author:   Roger Corley
::	Created:  May 14, 2015  11:39:53 AM
::
::========================================================================================================================================
:: Description:
::========================================================================================================================================
::
::	A log rotation batch file to be run on a weekly basis. This batch will rotate and archive
::	the 'gemonline.log' and 'GEMdaily.cp' log files stored on the system drive (C:\). Without
::	an archival process, these files continue to grow, which will eventually begin to slow any
::	transactions between Micros and GEMpay.
::
::
::---------------------------------------------------------------------------------------------------------------------------------------
:: ---[ Archives]---
::---------------------------------------------------------------------------------------------------------------------------------------
::
::	These logs are archived to a directory located on the C:\ drive named '_Gem-Log-Archives'.
::	The archive logs will be renamed and timestamped with the following nomenclature:
::
::.......................................................................................................................................
::
::	'gemonline' = 'C:\Gem-Logs-Archives\gemonline.<datetime>.log0<#>'
::------------------------------------------------------------------------
::	'GEMdaily.cp' = 'C:\Gem-Logs-Archives\GEMdaily.<datetime>.cp0<#>'
::
::.......................................................................................................................................
::
::	Each archived log will be stored for a maximum of twelve (12) weeks before being deleted
::	through the rotation process.
::
::
::---------------------------------------------------------------------------------------------------------------------------------------
::  ---[ Archive Location ]---
::---------------------------------------------------------------------------------------------------------------------------------------
::
::	If the directory '.\GEM\_Gem-Toolbox' with a subdirectory 'BatchScripts' doesn't exist, create
::	these directories first. Save this batch file as:
::
::.......................................................................................................................................
::		'.\GEM\_Gem-Toolbox\Batch-Files\Rotate-Gem-Logs-Weekly.bat'
::.......................................................................................................................................
::
::
::---------------------------------------------------------------------------------------------------------------------------------------
:: ---[ Scheduled Task ]---
::---------------------------------------------------------------------------------------------------------------------------------------
::
::	Create a Scheduled Task named 'Rotate-Gem-Logs-Weekly' with the following properties:
::.......................................................................................................................................
::
::	[ GENERAL ]	Run whether user is logged on or not: 'selected'
::-------------------------------------------------------------------------------------------------
::			Run with highest privileges:    'checked'
::
::.......................................................................................................................................
::
::	[ TRIGGERS ]	Settings: Weekly -- Start:  (Following Monday) at 4:45 AM
::-------------------------------------------------------------------------------------------------
::			Recur every:  '1' weeks on 'Monday' -- 'checked'
::-------------------------------------------------------------------------------------------------
::			Adv Settings: Stop task if it runs longer than: '30 mins'
::-------------------------------------------------------------------------------------------------
::			Enabled:  'checked'
::
::.......................................................................................................................................
::
::	[ ACTIONS ]	Start A Program: '.\GEM\_Gem-Toolbox\Batch-Files\Rotate-Gem-Logs-Weekly.bat'
::
::.......................................................................................................................................
::
::	[ SETTINGS ]	Allow task to be run on demand:   'checked'
::-------------------------------------------------------------------------------------------------
::			Stop the task if it runs longer than: '1 hour'
::
::.......................................................................................................................................
::
::
::
::
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::========================================================================================================================================
::
::			----[[[ ****  DO NOT MODIFY THIS SCRIPT   ****  ]]]----
::
::========================================================================================================================================
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
::
::
::
::
::========================================================================================================================================
:: EXTENSION: GEMonline
::========================================================================================================================================
::
::-------------------------------------------------------------------------------------
:: ---[ **NOTE** ]---	'gotype' MUST match the GEMonline log file extension in C:\
::			ALWAYS include the dot ( . ) before the type!
::-------------------------------------------------------------------------------------
::
	set "gotype=.log"

::========================================================================================================================================
:: EXTENSION: GEMdaily
::========================================================================================================================================
::
::---------------------------------------------------------------------------------------
:: ---[ **NOTE** ]---	'dtype' MUST match the GEMdaily log file extension in C:\
::			ALWAYS include the dot ( . ) before the type!
::---------------------------------------------------------------------------------------
::
	set "dtype=.cp"

::========================================================================================================================================
:: DATE CONSTANTS
::========================================================================================================================================
::
	for /f "delims=" %%a in ('wmic OS Get localdatetime  ^| find "."') do set "dt=%%a"

	set "YYYY=%dt:~0,4%"
	set "MM=%dt:~4,2%"
	set "DD=%dt:~6,2%"
	set "HH=%dt:~8,2%"
	set "Min=%dt:~10,2%"
	set "Sec=%dt:~12,2%"

	set "datestamp=%YYYY%/%MM%/%DD%"
	set "timestamp=%HH%:%Min%:%Sec%"
	set "fullstamp=%datestamp% %timestamp%"
	set "logstamp=%YYYY%-%MM%-%DD%"

::========================================================================================================================================
:: FILES: GEMonline
::========================================================================================================================================
::
	set "gname=gemonline"
	set "gfile=%gname%.log"
	set "gpath=C:\%gfile%"

::========================================================================================================================================
::FILES: GEMdaily
::========================================================================================================================================
::
	set "dname=GEMdaily"
	set "dfile=%dname%.cp"
	set "dpath=C:\%dfile%"

::========================================================================================================================================
::FILES: Archives
::========================================================================================================================================
::
	set "apath=C:\Gem-Logs-Archives\"
	set "apathgo=%apath%%gname%.%logstamp%.log01"
	set "apathgd=%apath%%dname%.%logstamp%.cp01"
	set "alog=%apath%*.log"
	set "acp=%apath%*.cp"

::========================================================================================================================================
::FILES: Import Log File
::========================================================================================================================================
::
	set "rlog=%apath%_rotateGOGDLogs.log"


::========================================================================================================================================
::BEGIN BATCH ROTATIONS
::========================================================================================================================================
::
::
	goto FileRotations

::
::
::---------------------------------------------------------------------------------------------------------------------------------------
:FileRotations
::---------------------------------------------------------------------------------------------------------------------------------------
		echo. >> %rlog%
		echo ============================================================================== >> %rlog%
		echo %fullstamp% : [ ROTATE ] : GEMonline - GEMDaily Log Rotations >> %rlog%
		echo ============================================================================== >> %rlog%
		echo. >> %rlog%

		echo .............................................................................. >> %rlog%
		echo %fullstamp% : [ MSG ] : Starting Log Rotations >> %rlog%
		echo .............................................................................. >> %rlog%


	goto chkGO

::---------------------------------------------------------------------------------------------------------------------------------------
:chkGO
::---------------------------------------------------------------------------------------------------------------------------------------

	if exist %gpath% (
		echo .............................................................................. >> !rlog!
		echo !fullstamp! : [ CHECKFILE ] : Checking Exist : !gpath! >> !rlog!
		echo !fullstamp! : [ CHECKFILE ] : !gpath! found. >> !rlog!
		echo !fullstamp! : [ CHECKFILE ] : Starting GEMonline Log Rotations >> !rlog!
		echo .............................................................................. >> !rlog!


	goto rotateGO

	) else (
		echo ============================================================================== >> !rlog!
		echo ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ >> !rlog!
		echo !fullstamp! : [ CHECK : ERROR ] : '!gpath!' NOT FOUND >> !rlog!
		echo !fullstamp! : [ CHECK : ERROR ] : Moving to Check GEMDaily >> !rlog!
		echo ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ >> !rlog!
		echo ============================================================================== >> !rlog!
		echo. >> !rlog!
	)

	goto chkGD

::---------------------------------------------------------------------------------------------------------------------------------------
:rotateGO
::---------------------------------------------------------------------------------------------------------------------------------------

	if exist %alog%12 del /f /q %alog%12
	if exist %alog%11 copy %alog%07 %alog%12
	if exist %alog%10 copy %alog%07 %alog%11
	if exist %alog%09 copy %alog%07 %alog%10
	if exist %alog%08 copy %alog%08 %alog%09
	if exist %alog%07 copy %alog%07 %alog%08
	if exist %alog%06 copy %alog%06 %alog%07
	if exist %alog%05 copy %alog%05 %alog%06
	if exist %alog%04 copy %alog%04 %alog%05
	if exist %alog%03 copy %alog%03 %alog%04
	if exist %alog%02 copy %alog%02 %alog%03
	if exist %alog%01 copy %alog%01 %alog%02

	if exist %gpath% move %gpath% %apathgo%

		echo .............................................................................. >> %rlog%
		echo !fullstamp! : [ ROTATE ] : GEMonline Log Rotations Complete. >> %rlog%
		echo !fullstamp! : [ ROTATE ] : Moving to Check GEMDaily. >> %rlog%
		echo .............................................................................. >> %rlog%


	goto chkGD

::---------------------------------------------------------------------------------------------------------------------------------------
:chkGD
::---------------------------------------------------------------------------------------------------------------------------------------

	if exist %dpath% (
		echo .............................................................................. >> !rlog!
		echo !fullstamp! : [ CHECKFILE ] : Checking Exist : !dpath! >> !rlog!
		echo !fullstamp! : [ CHECKFILE ] : !dpath! found. >> !rlog!
		echo !fullstamp! : [ CHECKFILE ] : Starting GEMDaily Log Rotations >> !rlog!
		echo .............................................................................. >> !rlog!


	goto rotateGD

	) else (
		echo ============================================================================== >> !rlog!
		echo ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ >> !rlog!
		echo !fullstamp! : [ CHECK : ERROR ] : '!dpath!' NOT FOUND >> !rlog!
		echo !fullstamp! : [ CHECK : ERROR ] : Ending Log Rotation Script >> !rlog!
		echo ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ >> !rlog!
		echo ============================================================================== >> !rlog!
		echo. >> !rlog!
	)

	goto done

::---------------------------------------------------------------------------------------------------------------------------------------
:rotateGD
::---------------------------------------------------------------------------------------------------------------------------------------

	if exist %acp%12 del /f /q %acp%12
	if exist %acp%11 copy %acp%07 %acp%12
	if exist %acp%10 copy %acp%07 %acp%11
	if exist %acp%09 copy %acp%07 %acp%10
	if exist %acp%08 copy %acp%08 %acp%09
	if exist %acp%07 copy %acp%07 %acp%08
	if exist %acp%06 copy %acp%06 %acp%07
	if exist %acp%05 copy %acp%05 %acp%06
	if exist %acp%04 copy %acp%04 %acp%05
	if exist %acp%03 copy %acp%03 %acp%04
	if exist %acp%02 copy %acp%02 %acp%03
	if exist %acp%01 copy %acp%01 %acp%02

	if exist %dpath% move %dpath% %apathgd%

		echo .............................................................................. >> %rlog%
		echo !fullstamp! : [ ROTATE ] : GEMDaily Log Rotations Complete. >> %rlog%
		echo !fullstamp! : [ ROTATE ] : Ending Log Rotation Script. >> %rlog%
		echo .............................................................................. >> %rlog%


	goto done

::---------------------------------------------------------------------------------------------------------------------------------------
:done
::---------------------------------------------------------------------------------------------------------------------------------------

		echo. >> %rlog%
		echo ============================================================================== >> %rlog%
		echo %fullstamp% : [ ROTATE ] : GEMonline - GEMDaily Log Rotations Completed >> %rlog%
		echo ============================================================================== >> %rlog%
		echo. >> %rlog%
		echo ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ >> %rlog%
		echo ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ >> %rlog%
		echo ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ >> %rlog%
		echo. >> %rlog%
